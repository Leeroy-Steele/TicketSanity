<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/flowbite"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />

    <!-- Script for fetching and sorting ticket tasks from PA-->
    <script defer>

        let user, password, LancomButtonId, DD4DDId, PrimaryBoard1, PrimaryBoard2, returnHSEIssues, returnCSPIssues, returnPromptIssues

        // Clear old fetched tasks first. Leave manual tasks
        function removeRowsExceptHeaderAndManualTask() {
            const table = document.getElementById('resultsTable');
            const rows = table.rows;
            let i = 1; // Start at 1 to skip the header row

            while (i < rows.length) {
                const row = rows[i];
                // Check if the row has the class 'manualTask'
                if (row.classList.contains('manualTask')) {
                    i++; // Skip this row and move to the next
                } else {
                    table.deleteRow(i); // Delete the row (index does not increment since rows shift)
                }
            }
        }

        // function to retrieve all tickets / jira issues from PA flow
        function getAllTasks() {
            // Remove stale tasks
            removeRowsExceptHeaderAndManualTask()
            // Add spinner
            document.getElementById('spinnerDiv').style.display = 'block'

            // Fetch live tickets from PA - https://make.powerautomate.com/environments/2e21e621-fcf3-eae1-a4d1-9e02b3152fc8/flows/6bfb118f-722a-44fa-9c84-1dfddefa790c/details
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            const raw = JSON.stringify({
                "User": user,
                "PW": password
            });
            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
                redirect: "follow"
            };
            fetch("https://prod-18.australiasoutheast.logic.azure.com:443/workflows/8ede7348e08746df81513d8b45912c0a/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=9ThA8L_C0klVuBaYpZ_kXvhoHHYLmBVlHnRgFWIxvJo", requestOptions)
                .then((response) => response.json())
                .then((result) => { 
                    // error handling for wrong password provided to PA
                    if(result.status==="wrong password"){
                        console.error(result.status);                
                        // remove spinner
                        document.getElementById('spinnerDiv').style.display = 'none'
                        // reopen auth modal
                        document.getElementById('authentication-modal').style.display = 'flex'
                        document.getElementById('passwordEnteredDiv').style.display = 'none'
                        document.getElementById('passwordLabel').innerText = 'Wrong password, try again'
                        document.getElementById('passwordLabel').style.color = 'red'
                        return
                    }

                    // IF PA is happy with auth, assign member preferences from PA flow response:
                    LancomButtonId = result.memberDetails.LancomButtonId
                    DD4DDId = result.memberDetails.DD4DDId
                    PrimaryBoard1 = result.memberBoards[0]
                    PrimaryBoard2 = result.memberBoards[1]
                    returnHSEIssues  = result.memberJiraBoardPreferences.returnHSEIssues
                    returnCSPIssues  = result.memberJiraBoardPreferences.returnCSPIssues
                    returnPromptIssues  = result.memberJiraBoardPreferences.returnPromptIssues

                    // update Dom with board preferences:
                    document.getElementById('hideTicketsNotFromBoardButton1').innerHTML = `<b>${PrimaryBoard1.ShortBoardName}</b>`
                    document.getElementById('hideTicketsNotFromBoardButton2').innerHTML = `<b>${PrimaryBoard2.ShortBoardName}</b>`
                    document.getElementById('spinnerDiv').style.display = 'none'

                    // Refactor jira issues payload
                    const jiraResults = result.jiraResults.map((issue) => {
                        const LancomJiraURL = `https://lancom.atlassian.net/browse/${issue.key}`

                        return {
                            name:issue.key,
                            ticketName: `<a href="${LancomJiraURL}" class="text-blue-600 hover:underline">${issue.key}</a>`,
                            techPortalLink: "",
                            contactName: issue.fields.assignee !== null ? issue.fields.assignee.displayName : "",
                            boardName: issue.key.startsWith("PBR") ? "Prompt" : issue.key.startsWith("CSP") ? "CSP Portal" : "HSE Connect",
                            priorityName: issue.fields.priority !== null ? issue.fields.priority.id : "",
                            assignedMembers: null,
                            LancomJiraURL: LancomJiraURL,
                            status: issue.fields.status.name,
                        };
                    })

                    // Refactor tickets payload to include jira links
                    const sortedTickets = result.ticketResults.map((ticket) => {
                        let CIJiraLink = ticket.tags.find((tag) => tag.startsWith("cis")) || "N/A";
                        CIJiraLink = CIJiraLink.toUpperCase();
                        let CIPacTicket = ticket.tags.find((tag) => tag.startsWith("pac")) || "N/A";
                        CIPacTicket = CIPacTicket.toUpperCase();
                        let LancomCSPJiraLink = ticket.tags.find((tag) => {
                            if (tag.startsWith("cspp")) { return true }
                            else if (tag.startsWith("pbr")) { return true }
                            else if (tag.startsWith("hse")) { return true }
                            else return false
                        })

                        LancomCSPJiraLink !== undefined ? LancomCSPJiraLink = LancomCSPJiraLink.toUpperCase() : LancomCSPJiraLink = "N/A";
                        return {
                            name:ticket.name.substring(0, 65),
                            ticketName: `<a href="https://cloud.lancom.tech/portal/v2/groups/my-tickets/tickets/${ticket.id}" class="text-blue-600 hover:underline">${ticket.name.substring(0, 65)}</a>`,
                            techPortalLink: ticket.board.name === "DeskDirector Support" ?
                                `<a href="https://support.deskdirector.com/tech/tickets/${ticket.id}" class="text-blue-600 hover:underline">${ticket.id}</a>`
                                :
                                `<a href="https://cloud.lancom.tech/tech/tickets/${ticket.id}" class="text-blue-600 hover:underline">${ticket.id}</a>`
                            ,
                            contactName: ticket.contact !== null ? ticket.contact.name : "",
                            boardName: ticket.board.name ==="Prompt Service Board" ? ticket.board.name.substring(0, 6):ticket.board.name==="HSE Connect Service Board"?ticket.board.name.substring(0, 11):ticket.board.name,
                            priorityName: ticket.priority.name.substring(9, 10),
                            assignedMembers: ticket.assignedMembers,
                            CIJiraLink:
                                CIJiraLink !== "N/A"
                                    ? `<a href="https://cloudinsurance.atlassian.net/servicedesk/customer/portal/1/${CIJiraLink}" class="text-blue-600 hover:underline">${CIJiraLink}</a>`
                                    : null,
                            LancomCSPJiraLink:
                                LancomCSPJiraLink !== "N/A"
                                    ? `<a href="https://lancom.atlassian.net/browse/${LancomCSPJiraLink}" class="text-blue-600 hover:underline">${LancomCSPJiraLink}</a>`
                                    : null,
                            pacTicketURL:
                                CIPacTicket !== "N/A"
                                    ? `<a href="https://cloudinsurance.atlassian.net/browse/${CIPacTicket}" class="text-blue-600 hover:underline">${CIPacTicket}</a>`
                                    : null,
                            status: ticket.status.name,
                        };
                    })

                    // Generate the HTML table rows from tickets payload
                    sortedTickets.forEach((ticket, index) => {

                        // Filter out tickets that are not relevant to me
                        if (ticket.boardName === PrimaryBoard1.BoardName ||
                            ticket.boardName === PrimaryBoard2.BoardName ||
                            ticket.assignedMembers != [] && ticket.assignedMembers.find(member => member.id === LancomButtonId) ||
                            ticket.assignedMembers != [] && ticket.assignedMembers.find(member => member.id === DD4DDId)
                        ) {

                            let tableRow = `
                            <tr id="row-${index}" class="ticketRow" draggable="true" ondragstart="drag(event)" ondragover="allowDrop(event)" ondrop="drop(event)">
                                <td class="py-1 px-2 border border-gray-200">${ticket.ticketName}</td>
                                <td style="max-width: 180px;" class="py-1 px-2 border border-gray-200">${ticket.contactName}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${ticket.techPortalLink}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${ticket.CIJiraLink || ticket.LancomCSPJiraLink || ""}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${ticket.pacTicketURL || ""}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${ticket.boardName || ""}</td>
                                <td class="py-1 px-1 text-center border border-gray-200">${ticket.status}</td>
                                <td style="width: 50px;" class="py-1 px-1 text-center border border-gray-200">${ticket.priorityName}</td>
                                
                                <td class="py-1 px-2 text-center meeting-notes border border-gray-200 span">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div onclick="tickBox('tickBoxDiv${index + 1}')">
                                            <img id="tickBoxDiv${index + 1}" width="30" height="30" src="${localStorage.getItem(ticket.name+": Check Box Url")?localStorage.getItem(ticket.name+": Check Box Url"):"https://img.icons8.com/ios/30/checked-2--v3.png"}" alt="checked-2--v3" />
                                        </div>
                                        <input id="${index}-notesField" type="text" class="w-full p-1 border rounded" placeholder="..." value="${localStorage.getItem(ticket.name+": Notes Field")?localStorage.getItem(ticket.name+": Notes Field"):""}" />
                                    </div>
                                </td>

                                <td class="py-1 px-2 text-center border border-gray-200 action-buttons">
                                    <button onclick="deleteRow(${index})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Remove</button>
                                    <button onclick="hideRow(${index})" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">Hide</button>
                                </td>

                            </tr>
                        `
                            const tableBody = document.getElementById("tableBody"); // Locate the <tbody>

                            // Append the row to the table body
                            tableBody.insertAdjacentHTML("beforeend", tableRow);

                        }
                    })

                    // Generate the HTML table rows from jira payload
                    jiraResults.forEach((issue, index) => {
                        if( issue.boardName==="Prompt" && returnPromptIssues ||
                            issue.boardName==="CSP Portal" && returnCSPIssues ||
                            issue.boardName==="HSE Connect" && returnHSEIssues
                        ){

                            let tableRow = `
                            <tr id="row-${index + 1000}" class="jiraRow" draggable="true" ondragstart="drag(event)" ondragover="allowDrop(event)" ondrop="drop(event)">
                                <td class="py-1 px-2 border border-gray-200"> Jira Issue: ${issue.ticketName}</td>
                                <td style="max-width: 180px;" class="py-1 px-2 border border-gray-200">${issue.contactName}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${issue.techPortalLink}</td>
                                <td class="py-1 px-2 text-center border border-gray-200">${issue.ticketName}</td>
                                <td class="py-1 px-2 text-center border border-gray-200"></td>
                                <td class="py-1 px-2 text-center border border-gray-200">${issue.boardName || ""}</td>
                                <td class="py-1 px-1 text-center border border-gray-200">${issue.status}</td>
                                <td style="width: 50px;" class="py-1 px-1 text-center border border-gray-200">${issue.priorityName}</td>
                                
                                <td class="py-1 px-2 text-center meeting-notes border border-gray-200 span">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div onclick="tickBox('tickBoxDiv${index + 1000}')">
                                            <img id="tickBoxDiv${index + 1000}" width="30" height="30" src="${localStorage.getItem("Jira Issue: " + issue.name+": Check Box Url")?localStorage.getItem("Jira Issue: " + issue.name+": Check Box Url"):"https://img.icons8.com/ios/30/checked-2--v3.png"}" alt="checked-2--v3" />
                                        </div>
                                        <input id="${index + 1000}-notesField" type="text" class="w-full p-1 border rounded" placeholder="..." value="${localStorage.getItem("Jira Issue: " + issue.name+": Notes Field")?localStorage.getItem("Jira Issue: " + issue.name+": Notes Field"):""}" />
                                    </div>
                                </td>

                                <td class="py-1 px-2 text-center border border-gray-200 action-buttons">
                                    <button onclick="deleteRow(${index + 1000})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Remove</button>
                                    <button onclick="hideRow(${index + 1000})" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">Hide</button>
                                </td>
                                
                            </tr>
                        `
                        const tableBody = document.getElementById("tableBody"); // Locate the <tbody>

                        // remove spinner
                        document.getElementById('spinnerDiv').style.display = 'none'

                        // Append the row to the table body
                        tableBody.insertAdjacentHTML("beforeend", tableRow);

                        }
                    })


                    // Add event listener to save user interaction to local storage
                    // Select the table
                    const fullTable = document.getElementById('resultsTable');
                    // Loop through all rows in the table body (ignoring the header)
                    const rows = fullTable.querySelectorAll('tbody tr');

                    rows.forEach(row => {

                        // notes input field
                        const notesField = row.cells[8]
                        const inputField = notesField.querySelector('input') // Select the input field

                        // TicketName field
                        const TicketName = row.cells[0]
                        const TicketNameText = TicketName.innerText

                        // Checked / Unchecked image
                        const imageElement = row.querySelector('.meeting-notes img');

                        // Check if the image exists
                        if (imageElement){

                            imageElement.addEventListener('click', function(event) {
                                const imageUrl = event.target.src; // Get the src of the clicked image
                                localStorage.setItem(TicketNameText+": Check Box Url", imageUrl==="https://img.icons8.com/color/30/checked-checkbox.png"?"https://img.icons8.com/ios/30/checked-2--v3.png":"https://img.icons8.com/color/30/checked-checkbox.png")

                            });

                        }

                        if (inputField) {
                            inputField.addEventListener('input', function() {

                                localStorage.setItem(TicketNameText+": Notes Field",inputField.value)

                            });
                        }

                    });

                })
                .catch((error) => {
                    console.error(error);                
                    // remove spinner
                    document.getElementById('spinnerDiv').style.display = 'none'
                });

        }

    </script>

    <!-- Script for manipulating table / ticket results -->
    <script>

        // Sort tickets by Priority / board / Status
        let sortAscendingOrder = true;
        function sortTableRows(columnName) {
            const table = document.getElementById("resultsTable");
            const tbody = table.tBodies[0];
            const rows = Array.from(tbody?.rows || []);

            if (rows.length === 0) {
                console.error("No rows found in the table body.");
                return;
            }

            // Map column names to indices (adjust indices to match your table)
            const columnMapping = {
                Board: 5,
                Status: 6,
                P: 7,
            };
            const columnIndex = columnMapping[columnName]; // This will take in the sort by columnName and return a columnMapping number (6,7,8)

            if (columnIndex === undefined) {
                console.error(`Invalid column name: "${columnName}".`);
                return;
            }

            console.log(`Sorting by column: ${columnName} (Index: ${columnIndex})`);

            // Sort rows by the specified column
            rows.sort((rowA, rowB) => {
                const cellA = rowA.cells[columnIndex]?.innerText.trim();    // row.cells[6] will find Board name for example
                const cellB = rowB.cells[columnIndex]?.innerText.trim();

                // Handle numeric sorting for the "P" column
                if (columnName === "P") {
                    const numA = parseFloat(cellA) || 0; // Convert to number or default to 0
                    const numB = parseFloat(cellB) || 0;

                    // Sort numerically
                    return sortAscendingOrder ?
                        numA - numB
                        :
                        numB - numA
                        ;
                }

                // Default to text sorting
                return sortAscendingOrder ?
                    cellA.localeCompare(cellB)
                    :
                    cellB.localeCompare(cellA)
                    ;

            });

            // Append sorted rows back to tbody
            rows.forEach(row => tbody.appendChild(row));
            sortAscendingOrder = !sortAscendingOrder
        }

        // for the tick option on each ticket row. Changes image to tick / box
        function tickBox(divID) {
            const targetImg = document.getElementById(`${divID}`)

            // Append the image to the div
            if (targetImg.src === "https://img.icons8.com/ios/30/checked-2--v3.png") {
                targetImg.src = 'https://img.icons8.com/color/30/checked-checkbox.png';
            } else {
                targetImg.src = 'https://img.icons8.com/ios/30/checked-2--v3.png';
            }
        }

        // Hide by source (Jirta / Tickets)
        function hideRowsbyDataSource(source) {
            unhideAll()
            const table = document.getElementById("resultsTable");
            const tbody = table.tBodies[0];
            const rows = tbody?.rows || [];

            if (source === "Lancom Button") {
                console.log("hide Lancom Button rows")
                Array.from(rows).forEach(row => {
                    if (row.classList.contains('ticketRow')){
                        row.style.display = "none"; // Hide the row
                    }
                });
            } else if (source === "Jira") {
                console.log("Hide Jira rows")

                Array.from(rows).forEach(row => {
                    if (row.classList.contains('jiraRow')){
                        row.style.display = "none"; // Hide the row
                    }
                });
            } 
        }


        // hide by Status
        function hideRowsWithStatus(statusToHide) {

            const table = document.getElementById("resultsTable");
            const tbody = table.tBodies[0];
            const rows = tbody?.rows || [];

            if (statusToHide === "Waiting on Client") {
                console.log("Waiting on Client")
                Array.from(rows).forEach(row => {
                    let statusCell = row.cells[6]; // Index of the Status column
                    if(statusCell===undefined){statusCell=row.cells[2]}

                    if (statusCell &&
                        statusCell.innerText.trim() === "Waiting on client" ||
                        statusCell.innerText.trim() === "Waiting on Client" ||
                        statusCell.innerText.trim() === "No response from client" ||
                        statusCell.innerText.trim() === "No Response from client" ||
                        statusCell.innerText.trim() === "Waiting Client Response"
                    ) {
                        row.style.display = "none"; // Hide the row
                    }
                });
            } else if (statusToHide === "Waiting on Dev") {
                console.log("Hide waiting on dev tasks")

                Array.from(rows).forEach(row => {
                    let statusCell = row.cells[6]; // Index of the Status column
                    if(statusCell===undefined){statusCell=row.cells[2]}
                        if (statusCell &&
                            statusCell.innerText.trim() === "Waiting on Development" ||
                            statusCell.innerText.trim() === "Waiting on Developer" ||
                            statusCell.innerText.trim() === "Waiting on Development - Backlog" ||
                            statusCell.innerText.trim() === "Waiting on Development - In Progress"
                        ) {
                            row.style.display = "none"; // Hide the row
                        }

                });
            } else if (statusToHide === "Waiting on Dev Only") {
                unhideAll()
                console.log("Waiting on Dev only")
                Array.from(rows).forEach(row => {
                    const statusCell = row.cells[6]; // Index of the Status column
                    if (statusCell &&
                        statusCell.innerText.trim() !== "Waiting on Development" &&
                        statusCell.innerText.trim() !== "Waiting on Developer" &&
                        statusCell.innerText.trim() !== "Waiting on Development - Backlog" &&
                        statusCell.innerText.trim() !== "Waiting on Development - In Progress"
                    ) {
                        row.style.display = "none"; // Hide the row
                    }
                });
            }
        }

        function hideTicketsNotFromBoard(boardToShow) {
            unhideAll()

            const table = document.getElementById("resultsTable");
            const tbody = table.tBodies[0];
            const rows = tbody?.rows || [];

            if (boardToShow === PrimaryBoard1.BoardName) {

                Array.from(rows).forEach(row => {
                    const boardCell = row.cells[5]; // Index of the Status column
                    if (boardCell &&
                        boardCell.innerText.trim().substring(0, 6) !== PrimaryBoard1.BoardName.substring(0, 6)
                    ) {
                        row.style.display = "none"; // Hide the row
                    }
                });
            } else if (boardToShow === PrimaryBoard2.BoardName) {

                Array.from(rows).forEach(row => {
                    const boardCell = row.cells[5]; // Index of the Status column
                    if (boardCell &&
                        boardCell.innerText.trim().substring(0, 6) !== PrimaryBoard2.BoardName.substring(0, 6)
                    ) {
                        row.style.display = "none"; // Hide the row
                    }
                });
            }
        }


        // Drag and drop table rows 
        let draggedRow = null;

        function drag(ev) {
            draggedRow = ev.target;
            ev.target.classList.add('dragging');
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drop(ev) {
            ev.preventDefault();
            const droppedRow = ev.target.closest('tr');
            if (draggedRow && droppedRow && draggedRow !== droppedRow) {
                const rows = Array.from(droppedRow.parentNode.children);
                const draggedIndex = rows.indexOf(draggedRow);
                const droppedIndex = rows.indexOf(droppedRow);

                if (draggedIndex < droppedIndex) {
                    droppedRow.after(draggedRow);
                } else {
                    droppedRow.before(draggedRow);
                }
            }
            draggedRow.classList.remove('dragging');
        }

        // Manually add table rows
        function addRow() {
            const tableBody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
            const newRow = document.createElement('tr');
            newRow.classList.add("manualTask")
            newRow.setAttribute('draggable', 'true');
            newRow.setAttribute('ondragstart', 'drag(event)');
            newRow.setAttribute('ondragover', 'allowDrop(event)');
            newRow.setAttribute('ondrop', 'drop(event)');
            const randomNumber = Math.floor(Math.random() * 900) + 100
            newRow.id = "row-" + randomNumber

            newRow.innerHTML = `
                <td colspan="6" class="p-1 border border-gray-200"><input type="text" placeholder="Task" class="w-full border rounded p-1"></td>
                <td style="width: 50px;" class="p-1 text-center border border-gray-200"><input type="text" placeholder="..." class="border rounded p-1"></td>
                <td style="width: 50px;" class="p-1 text-center border border-gray-200"><input style="width: 35px; "type="text" placeholder="..." class="border rounded p-1"></td>


                <td class="py-1 px-2 text-center meeting-notes border border-gray-200 span">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div onclick="tickBox('tickBoxDiv${randomNumber}')">
                            <img id="tickBoxDiv${randomNumber}" width="30" height="30" src="https://img.icons8.com/ios/30/checked-2--v3.png" alt="checked-2--v3" />
                        </div>
                        <input type="text" class="w-full p-1 border rounded" placeholder="..." />
                    </div>
                </td>

                <td class="p-1 text-center border border-gray-200 action-buttons">
                    <button onclick="deleteRow(${randomNumber})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>
                    <button onclick="this.closest('tr').style.display = 'none'" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">Hide</button>
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        function hideRow(index) {
            document.getElementById('row-' + index).style.display = 'none';
        }

        function deleteRow(index) {

            // Get innerHTML value of row collumn[0] to use as key to remove data from local storage 
            const row = document.getElementById('row-' + index)
            // TicketName field
            const TicketName = row.cells[0]
            const TicketNameText = TicketName.innerText

            // Remove data from local storage
            localStorage.removeItem(TicketNameText+": Notes Field")
            localStorage.removeItem(TicketNameText+": Check Box Url")

            // remove row
            document.getElementById('row-' + index).remove();

        }

        function unhideAll() {
            const rows = document.querySelectorAll('tr');
            rows.forEach(row => row.style.display = '');
        }
    </script>

    <style>
        h2 {
            color: #f1f1f1;
        }

        body {
            background-image: url("https://i.imgur.com/WNqOEoF.png");
            background-size: cover;
            /* background: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url('https://i.imgur.com/wUousYb.png'); */
        }

        tr.dragging {
            opacity: 0.5;
            background: #f1f1f1;
        }

        table {
            table-layout: fixed;
            width: 100%;
            background-color: whitesmoke;
        }

        .jira-columns {
            width: 100px;
        }

        .meeting-notes {
            width: 400px;
        }

        .action-buttons button {
            width: 90px;
            padding: 5px;
            white-space: nowrap;
        }

        tr:hover {
            background-color: rgba(240, 240, 240, 0.8);
        }

        #passwordEnteredDiv, #spinnerDiv {
            display: none;
        }
    </style>
</head>

<body>

    <!-- Authenticated DOM / table -->
    <div id="passwordEnteredDiv">
        <div class="flex justify-center gap-2 m-2">
            <div class="border border-dashed border-gray-500 text-xs text-center p-2 rounded-lg">
                <p class="mb-1 text-gray-200">Add / Refresh:</p>
                <div class="flex justify-center gap-2">
                    <button onclick="getAllTasks()" class="text-lg p-3 bg-green-500 text-white rounded hover:bg-green-600"><b>Refresh Dashboard</b></button>
                    <button onclick="addRow()" class="text-lg p-3 bg-green-500 text-white rounded hover:bg-green-600"><b>Add Manual Task</b></button>
                </div>
            </div>
        
            <div class="border border-dashed border-gray-500 text-xs text-center p-2 rounded-lg">
                <p class="mb-1 text-gray-200">Show only:</p>
                <div class="flex justify-center gap-2">
                    <button onclick="hideRowsbyDataSource('Jira')" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"><b>Tickets</b></button>
                    <button onclick="hideRowsbyDataSource('Lancom Button')" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"><b>Jira</b></button>
                    <button onclick="hideRowsWithStatus('Waiting on Dev Only')" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"><b>Waiting on Dev</b></button>
                    <button onclick="hideTicketsNotFromBoard(`${PrimaryBoard1.BoardName}`)" id="hideTicketsNotFromBoardButton1" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"></button>
                    <button onclick="hideTicketsNotFromBoard(`${PrimaryBoard2.BoardName}`)" id="hideTicketsNotFromBoardButton2" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"></button>
                </div>
            </div>

            <div class="flex items-center justify-center">
                <h2 id="titleH2" style="color: antiquewhite;" class="text-center text-2xl m-3 color-white">TicketSanity</h2>
                <div class="mr-6">
                    <img width="64" height="64" src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/64/external-octopus-animal-flaticons-lineal-color-flat-icons-3.png" alt="external-octopus-animal-flaticons-lineal-color-flat-icons-3"/>        
                </div>
            </div>


            <div class="border border-dashed border-gray-500 text-xs text-center p-2 rounded-lg">
                <p class="mb-1 text-gray-200">Hide All:</p>
                <div class="flex justify-center gap-2">
                    <button onclick="hideRowsWithStatus('Waiting on Client')" class="text-lg p-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded"><b>Waiting on Client</b></button>
                    <button onclick="hideRowsWithStatus('Waiting on Dev')" class="text-lg p-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded"><b>Waiting on Dev</b></button>
                </div>
            </div>

            <div class="border border-dashed border-gray-500 text-xs text-center p-2 rounded-lg">
                <p class="mb-1 text-gray-200">Restore:</p>
                <div class="flex justify-center gap-2">
                    <button onclick="unhideAll()" class="text-lg p-3 bg-blue-500 text-white rounded hover:bg-blue-600"><b>Unhide All</b></button>
                    <button disabled onclick="" class="text-lg py-3 px-6 bg-red-500 text-white rounded hover:bg-blue-600 disabled"><b>Save All</b></button>
                </div>
            </div>

            <div class="border border-dashed border-gray-500 text-xs text-center p-2 rounded-lg">
                <p class="mb-1 text-gray-200">Misc</p>
                <button disabled onclick="" class="text-lg py-3 px-6 bg-white text-black rounded hover:bg-grey-200 disabled"><b>Info</b></button>
           </div>
            
        </div>
        

        <div class="p-1 m-1">
            <table id="resultsTable"
                class="table-auto border-collapse border border-gray-300 w-full mx-auto text-sm text-gray-700">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="py-1 px-2 border border-gray-300">Ticket Name</th>
                        <th style="max-width: 180px;" class="py-1 px-2 border border-gray-300">Contact</th>
                        <th class="py-1 px-2 text-center border border-gray-300 jira-columns">Tech Portal</th>
                        <th class="py-1 px-2 text-center border border-gray-300 jira-columns">Jira 1</th>
                        <th class="py-1 px-2 text-center border border-gray-300 jira-columns">Jira 2</th>
                        <th onclick="sortTableRows('Board')"
                            class="py-1 px-2 text-center border border-gray-300 jira-columns">
                            Board</th>
                        <th onclick="sortTableRows('Status')" class="py-1 px-1 text-center border border-gray-300">Status
                        </th>
                        <th onclick="sortTableRows('P')" class="py-1 px-1 text-center border border-gray-300">P</th>
                        <th class="py-1 px-2 text-center meeting-notes border border-gray-300">Notes</th>
                        <th class="py-1 px-2 text-center border border-gray-300">Actions</th>
                        <th style="display: none">Board</th>
                    </tr>
                </thead>
                <tbody id="tableBody">


                </tbody>
            </table>
        </div>
    </div>

    <!-- Spinner -->
    <div id="spinnerDiv" role="status" class="text-center m-6 p-6">
        <svg aria-hidden="true" class="inline w-20 h-20 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
            <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
        </svg>
        <span class="sr-only">Loading...</span>
    </div>



    <!-- Sign in modal -->
    <div id="passwordNotEnteredDiv">
        <div id="authentication-modal" class="flex items-center justify-center min-h-screen ">
            <div class="relative p-4 w-full max-w-md max-h-full">
                <!-- Modal content -->
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <!-- Modal header -->
                    <div class="flex items-center justify-center p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mr-2">
                            TicketSanity
                        </h3>
                        <img width="64" height="64" src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/64/external-octopus-animal-flaticons-lineal-color-flat-icons-3.png" alt="external-octopus-animal-flaticons-lineal-color-flat-icons-3"/>
                    </div>
                    <!-- Modal body -->
                    <div class="p-4 md:p-5">
                        <form class="space-y-4" action="#" id="authModal">

                            <label class="block pb-2 mb-2 text-sm font-medium text-gray-900 dark:text-white text-center">Select your name</label>
                            <div style="margin: auto; width: 100%;" class="inline-flex rounded-md shadow-sm justify-between " role="group">
                                <button type="button" class="name-button px-6 py-4 text-lg text-gray-900 bg-white border border-gray-200 rounded-s-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white" data-name="Lee">
                                    Lee
                                  </button>
                                  <button type="button" class="name-button px-6 py-4 text-lg text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white" data-name="Leo">
                                    Leo
                                  </button>
                                  <button type="button" class="name-button px-6 py-4 text-lg text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white" data-name="Aaron">
                                    Aaron
                                  </button>
                                  <button type="button" class="name-button px-6 py-4 text-lg text-gray-900 bg-white border border-gray-200 rounded-e-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white" data-name="Collin">
                                    Collin
                                  </button>
                              </div>

                              <div>
                                <label id="passwordLabel" for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white text-center">Enter your password</label>
                                <input type="password" name="password" id="password" placeholder="••••••••" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required />
                            </div>

                              <input type="hidden" name="selectedName" id="selectedName" value="">
                            <button type="submit" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Lets Rock</button>
                        </form>
                    </div>
                </div>
            </div>
        </div> 
    </div>

    <!-- Script for authentication modal -->
    <script>
        // JavaScript to handle form submission
        const form = document.getElementById('authModal');
        const nameButtons = document.querySelectorAll('.name-button');
        const selectedNameInput = document.getElementById('selectedName');
    
        // Handle button clicks to select a name
        nameButtons.forEach(button => {
          button.addEventListener('click', () => {
            const selectedName = button.getAttribute('data-name');
            selectedNameInput.value = selectedName; // Set the hidden input value
            console.log(`Selected Name: ${selectedName}`);
          });
        });
    
        // Handle form submission
        form.addEventListener('submit', (event) => {
          event.preventDefault(); // Prevent the default form submission
          
          // Get form values
          const passwordInputValue = document.getElementById('password').value;
          const selectedName = selectedNameInput.value;
    
          if (!selectedName) {
            alert('Please select a name before submitting.');
            return;
          }
    
          // Handle the form data
          document.getElementById('authentication-modal').style.display = 'none'
          document.getElementById('passwordEnteredDiv').style.display = 'block'
          document.getElementById('spinnerDiv').style.display = 'block'

          user = selectedName;
          password = passwordInputValue;
          getAllTasks()

        // update Dom with board preferences:
        document.getElementById('titleH2').innerHTML = `<b>${user}'s TicketSanity</b>`



        });
      </script>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
</body>

</html>


